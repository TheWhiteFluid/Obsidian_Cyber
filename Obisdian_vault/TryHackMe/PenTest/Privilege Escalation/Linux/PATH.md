PATH in Linux is an environmental variable that tells the operating system where to search for executables. For any command that is not built into the shell or that is not defined with an absolute path, Linux will start searching in folders defined under PATH. (PATH is the environmental variable || path is the location of a file).  

![[Pasted image 20240824013559.png]]

As you will see, this depends entirely on the existing configuration of the target system, so be sure you can answer the questions below before trying this.
1. What folders are located under $PATH
2. Does your current user have write privileges for any of these folders?
3. Can you modify $PATH?
4. Is there a script/application you can start that will be affected by this vulnerability?

A simple search for writable folders can done using the `find / -writable 2>/dev/null` command. The output of this command can be cleaned using a simple cut and sort sequence.
	![[Pasted image 20240824015732.png]]
Comparing this with PATH will help us find folders we could use.
	![[Pasted image 20240824015830.png]]
Let's say that we find a script file in one of the directories:
	![[Pasted image 20240824020417.png]]
This script tries to launch a system binary called “thm” but the example can easily be replicated with any binary. We compile this into an executable and set the SUID bit.
	![](https://i.imgur.com/A6QQ65I.png)
	Our user now has access to the “path” script with SUID bit set.

Once executed “path” script will look for an executable named “thm” inside folders listed under PATH. If any writable folder is listed under PATH we could create a binary named thm under that directory and have our “path” script run it. As the SUID bit is set, this binary will run with root privilege.

We see a number of folders under `/usr`, thus it could be easier to run our writable folder search once more to cover subfolders.  Unfortunately, subfolders under `/usr` are not writable.

The folder that will be easier to write to is probably `/tmp.` At this point because `/tmp` is not present in PATH so we will need to add it using:
 `export PATH=/tmp:$PATH` 
	![[Pasted image 20240824015928.png]]
At this point the path script will also look under the `/tmp` folder for an executable named “thm”. Creating this command is fairly easy by copying `/bin/bash` as “thm” under the `/tmp` folder.
	![[Pasted image 20240824020032.png]]
We have given executable rights to our copy of `/bin/bash`, please note that at this point it will run with our user’s right. What makes a privilege escalation possible within this context is that the path script runs with root privileges.
	![[Pasted image 20240824020108.png]]

## **Examples**
Q)What is the odd folder you have write access for?
- `echo $PATH`
- `find / -writable 2>/dev/null | cut -d "/" -f 2,3 | sort -u`
  ![[Pasted image 20240824021450.png]]
Q)Exploit the $PATH vulnerability to read the content of the flag6.txt file.
	![[Pasted image 20240824021557.png]]![[Pasted image 20240824021755.png]]
- create the thm file that thm.py is using and we will add our exploit: `sudo su-` to gain root privilegies to acces matt files from home directory.
- we have to set chmod 777 to our thm created file and add it's path to the $PATH variable.
  `export PATH=/home/murdoch:$PATH`
	  ![[Pasted image 20240825200751.png]]
