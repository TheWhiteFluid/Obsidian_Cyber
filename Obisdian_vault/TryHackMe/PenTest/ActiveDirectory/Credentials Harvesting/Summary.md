**Credential Harvesting** means stealing usernames and passwords from users or systems. Attackers use this technique to find and steal stored credentials, such as login details or account names.

There are many ways to harvest credentials, such as:
- **Network sniffing**, where attackers capture credentials sent over the network.
- **Searching for stored credentials** in places like plain text files, the system registry, or memory dumps.

Credentials can be found in a variety of different forms, such as:
- Accounts details (usernames and passwords)
- Hashes that include NTLM hashes, etc.
- Authentication Tickets: Tickets Granting Ticket (TGT), Ticket Granting Server (TGS)  
- Any information that helps login into a system (private keys, etc.)

Generally speaking, there are two types of credential harvesting: 
 - *External credential harvesting* (phishing emails and other techniques to trick a user into entering his username and password). 
-  *Internal credential harvesting* (obtaining credentials through the internal network uses different approaches).

# Credential Access
Credential access is where adversaries may find credentials in compromised systems and gain access to user credentials. It helps adversaries to reuse them or impersonate the identity of a user. This is an important step for lateral movement and accessing other resources such as other applications or systems. Obtaining legitimate user credentials is preferred rather than exploiting systems using CVEs.

For more information, you may visit the MITRE ATT&CK framework ([TA0006](https://attack.mitre.org/tactics/TA0006/)).

Credentials are stored insecurely in various locations in systems:
- Clear-text files;
- Database files;
- Memory;
- Password managers;
- Enterprise Vaults;
- Active Directory;
- Network Sniffing;

## Clear-text files
Attackers may search a compromised machine for credentials in local or remote file systems. Clear-text files could include sensitive information created by a user, containing passwords, private keys, etc. The MITRE ATT&CK framework defines it as **Unsecured Credentials: Credentials In Files** ([T1552.001](https://attack.mitre.org/techniques/T1552/001/)).

The following are some of the types of clear-text files that an attacker may be interested in:
- Commands history
- Configuration files (Web App, FTP files, etc.)
- Other Files related to Windows Applications (Internet Browsers, Email Clients, etc.)
- Backup files
- Shared files and folders
- Registry
- Source code

As an example of a history command, a PowerShell saves executed PowerShell commands in a history file in a user profile in the following path: 
```
`C:\Users\USER\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt`
```

It might be worth checking what users are working on or finding sensitive information. Another example would be finding interesting information. For example, the following command is to look for the "password" keyword in the Window registry.
```shell-session
c:\Users\user> reg query HKLM /f password /t REG_SZ /s
#OR
C:\Users\user> reg query HKCU /f password /t REG_SZ /s
```

## Database Files
Applications utilize database files to read or write settings, configurations, or credentials. Database files are usually stored locally in Windows operating systems. These files are an excellent target to check and hunt for credentials. For more information, we suggest checking THM room: [Breaching AD](https://tryhackme.com/room/breachingad). It contains a showcase example of extracting credentials from the local McAfee Endpoint database file.

## Password Managers
A password manager is an application to store and manage users' login information for local and Internet websites and services. Since it deals with users' data, it must be stored securely to prevent unauthorized access. 

Examples of Password Manager applications:
- Built-in password managers (Windows)
- Third-party: KeePass, 1Password, LastPass

Various tools could be used during the enumeration stage to get sensitive data in password manager applications used by Internet browsers and desktop applications.

## Memory Dump
The Operating system's memory is a rich source of sensitive information that belongs to the Windows OS, users, and other applications. Data gets loaded into memory at run time or during the execution. Thus, accessing memory is limited to administrator users who fully control the system.

The following are examples of memory stored sensitive data, including:
- Clear-text credentials
- Cached passwords
- AD Tickets

## Active Directory
Active Directory stores a lot of information related to users, groups, computers, etc. Thus, enumerating the Active Directory environment is one of the focuses of red team assessments. Active Directory has a solid design, but misconfiguration made by admins makes it vulnerable to various attacks shown in this room.


```
Get-ADUser -Filter * -Properties * | select Name,SamAccountName,Description
```

The following are some of the Active Directory misconfigurations that may leak users' credentials:
- **Users' description**: Administrators set a password in the description for new employees and leave it there, which makes the account vulnerable to unauthorized access. 
- **Group Policy SYSVOL**: Leaked encryption keys let attackers access administrator accounts. 
- **NTDS:** Contains AD users' credentials, making it a target for attackers.
- **AD Attacks:** Misconfiguration makes AD vulnerable to various attacks.

For a simple AD enumeration we can use:
```
Get-ADUser -Filter * -Properties * | select Name,SamAccountName,Description
```

## Network Sniffing
Gaining initial access to a target network enables attackers to perform various network attacks against local computers, including the AD environment. The *Man-In-the-Middle* attack against network protocols lets the attacker create a rogue or spoof trusted resources within the network to steal authentication information such as *NTLM hashes*.