- `whois` to query WHOIS servers
- `nslookup` to query DNS servers
- `dig` to query DNS servers

We use `whois` to query WHOIS records, while we use `nslookup` and `dig` to query DNS database records. These are all publicly available records and hence do not alert the target.

These two online services allow us to collect information about our target without directly connecting to it:
- DNSDumpster (https://dnsdumpster.com/)
- Shodan.io (https://www.shodan.io/)

Reconnaissance (recon) can be defined as a preliminary survey to gather information about a target. It is the first step in [The Unified Kill Chain](https://www.unifiedkillchain.com/) to gain an initial foothold on a system. We divide reconnaissance into:
1. Passive Reconnaissance
2. Active Reconnaissance

In **passive reconnaissance**, you rely on publicly available knowledge. It is the knowledge that you can access from publicly available resources without directly engaging with the target. Passive reconnaissance activities include many activities, for instance:
- Looking up DNS records of a domain from a public DNS server.
- Checking job ads related to the target website.
- Reading news articles about the target company.

**Active reconnaissance**, on the other hand, cannot be achieved so discreetly. It requires direct engagement with the target. Examples of active reconnaissance activities include:
- Connecting to one of the company servers such as HTTP, FTP, and SMTP.
- Calling the company in an attempt to get information (social engineering).
- Entering company premises pretending to be a repairman.

##  #Whois
WHOIS is a request and response protocol that follows the [RFC 3912](https://www.ietf.org/rfc/rfc3912.txt) specification. A WHOIS server listens on TCP port 43 for incoming requests. The domain registrar is responsible for maintaining the WHOIS records for the domain names it is leasing.
![[Pasted image 20240714141006.png]]

The WHOIS server replies with various information related to the domain requested. Of particular interest, we can learn:
- Registrar: Via which registrar was the domain name registered?
- Contact info of registrant: Name, organization, address, phone, among other things. (unless made hidden via a privacy service)
- Creation, update, and expiration dates: When was the domain name first registered? When was it last updated? And when does it need to be renewed?
- Name Server: Which server to ask to resolve the domain name?

 The syntax is `whois DOMAIN_NAME`. 

The information collected can be inspected to find new attack surfaces, such as social engineering or technical attacks. For instance, depending on the scope of the penetration test, you might consider an attack against the email server of the admin user or the DNS servers, assuming they are owned by your client and fall within the scope of the penetration test.

**Note**:
	It is important to note that due to automated tools abusing WHOIS queries to harvest email addresses, many WHOIS services take measures against this. They might redact email addresses, for instance. Moreover, many registrants subscribe to privacy services to avoid their email addresses being harvested by spammers and keep their information private.

## #nslookup
 The syntax is `nslookup OPTIONS DOMAIN_NAME SERVER`
 
- **OPTIONS** contains the query type as shown in the table below. For instance, you can use `A` for IPv4 addresses and `AAAA` for IPv6 addresses.
- **DOMAIN_NAME** is the domain name you are looking up.
- **SERVER** is the DNS server that you want to query. You can choose any local or public DNS server to query. 
	Cloudflare offers `1.1.1.1` and `1.0.0.1`
	Google offers `8.8.8.8` and `8.8.4.4`
	Quad9 offers `9.9.9.9` and `149.112.112.112`. 
	*There are many [more public DNS servers](https://duckduckgo.com/?q=public+dns) that you can choose from if you want alternatives to your ISP’s DNS servers.*

|Query type|Result|
|---|---|
|A|IPv4 Addresses|
|AAAA|IPv6 Addresses|
|CNAME|Canonical Name|
|MX|Mail Servers|
|SOA|Start of Authority|
|TXT|TXT Records|

ex: `nslookup -type=A tryhackme.com 1.1.1.1` return all the IPv4 addresses used by tryhackme.com.

![[Pasted image 20240714140931.png]]

ex: `nslookup -type=MX tryhackme.com` return all the email servers and configurations.

![[Pasted image 20240714140917.png]]

*We can see that tryhackme.com’s current email configuration uses Google.* 

Since MX is looking up the Mail Exchange servers, we notice that when a mail server tries to deliver email `@tryhackme.com`, it will try to connect to the `aspmx.l.google.com`, which has order 1. 
If it is busy or unavailable, the mail server will attempt to connect to the next in order mail exchange servers, `alt1.aspmx.l.google.com` or `alt2.aspmx.l.google.com`.

## #dig
For more advanced DNS queries and additional functionality, we can use `dig`.

The syntax is `dig @SERVER DOMAIN_NAME TYPE`.

- **SERVER** is the DNS server that you want to query.
- **DOMAIN_NAME** is the domain name you are looking up.
- **TYPE** contains the DNS record type, as shown in the table provided earlier.

A quick comparison between the output of `nslookup` and `dig` shows that `dig` returned more information, such as the TTL (Time To Live) by default.

ex: `dig @1.1.1.1 tryhackme.com MX`

![[Pasted image 20240714141711.png]]

## #DNSDumpster

DNS lookup tools, such as nslookup and dig, cannot find subdomains on their own. The domain you are inspecting might include a different subdomain that can reveal much information about the target.

 [DNSDumpster](https://dnsdumpster.com/) will return the collected DNS information in easy-to-read tables and a graph & will also provide any collected information about listening servers.

![[Pasted image 20240714142328.png]]

## #Shodan.io

 [Shodan.io](https://www.shodan.io/) can be helpful to learn various pieces of information about the client’s network, without actively connecting to it. Furthermore, on the defensive side, you can use different services from Shodan.io to learn about connected and exposed devices belonging to your organization.
 
Shodan.io tries to connect to every device reachable online to build a search engine of connected “things” in contrast with a search engine for web pages. Once it gets a response, it collects all the information related to the service and saves it in the database to make it searchable.

![[Pasted image 20240714142842.png]]

We can learn several things related to our search, such as:
- IP address
- hosting company
- geographic location
- server type and version