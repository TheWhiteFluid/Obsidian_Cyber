Nmap is an industry-standard tool for mapping networks, identifying live hosts, and discovering running services. A Nmap scan usually goes through the steps shown in the figure below, although many are optional and depend on the command-line arguments you provide.

![[Pasted image 20240726223921.png]]

## Subnetworks

 A _network segment_ is a group of computers connected using a shared medium. For instance, the medium can be the Ethernet switch or WiFi access point. In an IP network, a _subnetwork_ is usually the equivalent of one or more network segments connected together and configured to use the same router.
 
*The network segment refers to a physical connection, while a subnetwork refers to a logical connection.

A subnetwork, or simply a subnet, has its own IP address range and is connected to a more extensive network via a router.

![[Pasted image 20240726224139.png]]

- Subnets with `/16`, which means that the subnet mask can be written as `255.255.0.0`. This subnet can have around 65 thousand hosts.
- Subnets with `/24`, which indicates that the subnet mask can be expressed as `255.255.255.0`. This subnet can have around 250 hosts.

 If you are connected to the **same subnet**, you would expect your scanner to rely on ARP (Address Resolution Protocol) queries to discover live hosts. An ARP query aims to get the hardware address (MAC address) so that communication over the link-layer becomes possible;
 
If you are connected to a subnet **different** from the subnet of the target system(s), all packets generated by your scanner will be routed via the default gateway (router) to reach the systems on another subnet;  ARP queries won’t be routed and hence cannot cross the subnet router. ARP is a link-layer protocol, and ARP packets are bound to their subnet.


## Enumerating Targets

Generally speaking, you can provide a **list**, a **range**, or a **subnet**. 

Examples of target specification are:

- **list**: `MACHINE_IP scanme.nmap.org example.com` will scan 3 IP addresses.
- **range**: `10.11.12.15-20` will scan 6 IP addresses: `10.11.12.15`, `10.11.12.16`,… and `10.11.12.20`.
- **subnet**: `MACHINE_IP/30` will scan 4 IP addresses.

`nmap -iL list_of_hosts.txt` - scan list of host
`nmap -sL TARGET` - perform a list scan with DNS resolution

`nmap -sL -n TARGET` - perform a list scan without  DNS resolution (-n)
![[Pasted image 20240726225145.png]]

`nmap -sL -n RANGE OF IPS` - list scan of the whole range of IPs provided
![[Pasted image 20240726235644.png]]

## Discovering Live Hosts

 We will leverage the protocols to discover the live hosts. Starting from bottom to top, we can use:
 
- **ARP** from **Link** Layer
- **ICMP** from **Network** Layer
- **TCP** from **Transport** Layer
- **UDP** from **Transport** Layer

![[Pasted image 20240727005356.png]]

 - **ARP** has one purpose: sending a frame to the broadcast address on the network segment and asking the computer with a specific IP address to respond by providing its MAC (hardware) address.
- **ICMP** has [many types](https://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml). ICMP ping uses Type 8 (Echo) and Type 0 (Echo Reply). 
  If you want to ping a system on the same subnet, an **ARP** query should precede the **ICMP Echo**.
- **TCP** and **UDP** are transport layers, for network scanning purposes, a scanner can send a specially-crafted packet to common **TCP** or **UDP** ports to check whether the target will respond. This method is efficient, especially when **ICMP Echo** is blocked.

## Nmap Host Discovery Using ARP
