Metasploit has a number of modules to scan open ports on the target system and network. You can list potential port scanning modules available using the `search portscan` command.
![[Pasted image 20240814053144.png]]

![[Pasted image 20240814053207.png]]

Port scanning modules will require you to set a few options:
- **CONCURRENCY:** Number of targets to be scanned simultaneously.
- **PORTS:** Port range to be scanned. Please note that 1-1000 here will not be the same as using Nmap with the default configuration. Nmap will scan the 1000 most used ports, while Metasploit will scan port numbers from 1 to 10000.
- **RHOSTS:** Target or target network to be scanned.
- **THREADS:** Number of threads that will be used simultaneously. More threads will result in faster scans.

You can directly perform Nmap scans from the msfconsole prompt as shown below faster:
![[Pasted image 20240814053243.png]]

### UDP service Identification
The `scanner/discovery/udp_sweep` module will allow you to quickly identify services running over the UDP (User Datagram Protocol). As you can see below, this module will not conduct an extensive scan of all possible UDP services but does provide a quick way to identify services such as DNS or NetBIOS.
![[Pasted image 20240814053416.png]]

### SMB Scans
Metasploit offers several useful auxiliary modules that allow us to scan specific services. Below is an example for the SMB. Especially useful in a corporate network would be `smb_enumshares` and `smb_version`.
![[Pasted image 20240814053515.png]]

When performing service scans, it would be important not to omit more "exotic" services such as NetBIOS. NetBIOS (Network Basic Input Output System), similar to SMB, allows computers to communicate over the network to share files or send files to printers. The NetBIOS name of the target system can give you an idea about its role and even importance (e.g. CORP-DC, DEVOPS, SALES, etc.). You may also run across some shared files and folders that could be accessed either without a password or protected with a simple password (e.g. admin, administrator, root, toor, etc.)

*Note:*
	 Metasploit has many modules that can help you have a better understanding of the target system and possibly help you find vulnerabilities. It is always worth performing a quick search to see if there are any modules that could be helpful based on your target system.



## Vulnerability Scanning
Metasploit allows you to quickly identify some critical vulnerabilities that could be considered as “low hanging fruit”.  The term “low hanging fruit” usually refers to easily identifiable and exploitable vulnerabilities that could potentially allow you to gain a foothold on a system and, in some cases, gain high-level privileges such as root or administrator.

Finding vulnerabilities using Metasploit will rely heavily on your ability to scan and fingerprint the target. The better you are at these stages, the more options Metasploit may provide you. For example, if you identify a VNC service running on the target, you may use the `search` function on Metasploit to list useful modules. The results will contain payload and post modules. At this stage, these results are not very useful as we have not discovered a potential exploit to use just yet. However, in the case of VNC, there are several scanner modules that we can use.
![[Pasted image 20240815181242.png]]

### Exploitation
As the name suggests, Metasploit is an exploitation framework. Exploits are the most populated module category.
![[Pasted image 20240815181431.png]]

Most of the exploits will have a preset default payload. However, you can always use the `show payloads` command to list other commands you can use with that specific exploit.
![[Pasted image 20240815181453.png]]

*Note:*
	Choosing a working payload could become a trial and error process due to environmental or OS restrictions such as firewall rules, anti-virus, file writing, or the program performing the payload execution isn't available (eg. payload/python/shell_reverse_tcp).

Once a session is opened, you can background it using `CTRL+Z` or abort it using `CTRL+C`. Backgrounding a session will be useful when working on more than one target simultaneously or on the same target with a different exploit and/or shell.

## Examples
1)How many ports are open on the target system?
	search portscan
	use scanner/portscan/syn
	setg rhost -> machine.ip

2)Using the relevant scanner, what NetBIOS name can you see?
	search netbios
	use scanner/netbios/nbname

3)What is running on port 8000?
	search http_version
	use scanner/http/http_version
	set rport -> 8000
	
4)What is the "penny" user's SMB password? Use the wordlist mentioned in the previous task.
	search smb_login
	use scanner/smb/smb_login
	set SMBuser -> penny
	set PASS_FILE -> MetasploitWordlist-1632491116676.txt
	set STOP_ON_SUCCES -> true
