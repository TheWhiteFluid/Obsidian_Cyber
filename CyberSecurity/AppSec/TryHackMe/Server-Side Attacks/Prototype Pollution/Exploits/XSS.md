
## Standard Approach
As we know, numerous properties are inherently present on the Object prototype in JavaScript. Among these, the `constructor` and `__proto__` properties stand out as particularly notable targets for exploitation by threat actors. The `constructor` property points to the function that constructs an object's prototype, while `__proto__` is a reference to the prototype object that the current object directly inherits from. Malicious actors often exploit these properties to manipulate an object's prototype chain, potentially leading to prototype pollution.

## Golden Rule
The concept hinges on an attacker’s ability to influence certain key parameters, such as `x` and `val`, in expressions akin to `Person[x][y] = val`. Suppose an attacker assigns `__proto__` to `x`. In that case, the attribute identified by `y` is universally set across all objects sharing the same class as the object with the value denoted by `val`.

In a more intricate scenario, when an attacker has control over `x`, `y`, and `val` in a structure like `Person[x][y][z] = val`, assigning `x` as `constructor` and `y` as `prototype` leads to a new property defined by `z` being established across all objects in the application with the assigned `val`. This latter approach necessitates a more complex arrangement of object properties, making it less prevalent in practice.

Before any updates are made, we have an initial friends array containing an object representing a friend’s profile. Each profile object includes properties such as id, name, reviews, and albums.

## Few Important Functions
When identifying potential prototype pollution vulnerabilities, penetration testers should focus on commonly used vectors/functions susceptible to prototype pollution. A thorough examination of how an application handles object manipulation is crucial. We will understand a few important functions that an attacker can exploit, and then we will practically perform the exploitation.

- **Property Definition by Path**: Functions that set object properties based on a given path (like `object[a][b][c] = value`) can be dangerous if the path components are controlled by user input. These functions should be inspected to ensure they don't inadvertently modify the object's prototype. Consider an endpoint that allows users to update reviews about any friend.

### **Initial Object Structure**
Before any updates are made, we have an initial friends array containing an object representing a friend's profile. Each profile object includes properties such as id, name, reviews, and albums.

```javascript
let friends = [ { id: 1, name: "testuser", age: 25, country: "UK", reviews: [], albums: [{ }], password: "xxx", } ]; 
_.set(friend, input.path, input.value);
```

### **Input Received from User**
The user wants to add a review for their friend. They provide a payload containing the path where the review should be added (**reviews.content**) and the review content `(<script>alert(anycontent)</script>)`.  

An attacker updates the path to target the prototype:
```javascript
{ "path": "reviews[0].content", "value": "&#60;script&#62;alert('anycontent')&#60;/script&#62;" };
```

We use the `_set` function from lodash to apply the payload and add the review content to the specified path within the friend's profile object.

### **Resulting Object Structure**
After executing the code, the friends array will be modified to include the user's review. However, due to a lack of proper input validation, the review content provided by the user `(<script>alert('anycontent')</script>)` was directly added to the profile object without proper sanitisation.

```javascript
let friends = [
  {
    id: 1,
    name: "testuser",
    age: 25,
    country: "UK",
    reviews: [
      "<script>alert('anycontent')</script>"
    ],
    albums: [{}],
    password: "xxx",
  }
];
```

Similarly, suppose the attacker wants to insert a malicious property into the friend's profile. In that case, they provide a payload containing the path where the property should be added (**isAdmin**) and the value for the malicious property (true).  

```javascript
const payload = { "path": "isAdmin", "value": true };
```

After executing the code, the `friends` array will be modified to include the malicious property **isAdmin** in the friend's profile object. The `friends` object will have the following structure:

```javascript
let friends = [
  {
    id: 1,
    name: "testuser",
    age: 25,
    country: "UK",
    reviews: [],
    albums: [],
    password: "xxx",
    isAdmin: true // Malicious property inserted by the attacker
  }
];
```

## Example
