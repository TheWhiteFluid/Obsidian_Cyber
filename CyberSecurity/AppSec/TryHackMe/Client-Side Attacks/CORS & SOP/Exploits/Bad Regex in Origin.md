Exploiting bad regular expressions (regex) in CORS origin handling is a technique that involves taking advantage of poorly implemented regex patterns used by web applications to validate origins in CORS headers. For example, below is the vulnerable code of [http://corssop.thm/badregex.php](http://corssop.thm/badregex.php)

```php
if (isset($_SERVER['HTTP_ORIGIN']) && preg_match('#corssop.thm#', $_SERVER['HTTP_ORIGIN'])) {
    header("Access-Control-Allow-Origin: ".$_SERVER['HTTP_ORIGIN']."");
    header('Access-Control-Allow-Credentials: true');
}
```

The code above implements a flawed CORS policy since it validates domains that contain the word `corssop.thm`. An attacker might use an origin like `http://corssop.thm.evilcors.thm` that technically matches the pattern.

![](Pasted%20image%2020250206131135.png)

We can reuse the exploit code we used earlier to exploit the vulnerable code above. Just change the target URL to [http://corssop.thm/badregex.php](http://corssop.thm/badregex.php). The exploit code can bypass the CORS since it's hosted in [http://corssop.thm.evilcors.thm](http://corssop.thm.evilcors.thm/).

![](Pasted%20image%2020250206131940.png)

![](Pasted%20image%2020250206132312.png)


So, in a nutshell, below is the entire process of the exploitation once the user clicks or visits the hosted exploit code:
	![](Pasted%20image%2020250206131239.png)
