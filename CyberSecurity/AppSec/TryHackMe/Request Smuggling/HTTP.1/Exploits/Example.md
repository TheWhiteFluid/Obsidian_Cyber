The vulnerable environment has ATS (Apache Traffic Server) as the front-end proxy, Nginx as the web server back-end, and PHP processing the dynamic content. Due to differences in how ATS and Nginx prioritise `Content-Length` and `Transfer-Encoding` headers, there is a potential for HTTP request smuggling. Start by adding `httprequestsmuggling.thm` to your `/etc/hosts` file.

- /etc/hosts
```shell
127.0.0.1       localhost
127.0.1.1       tryhackme.lan   tryhackme
MACHINE_IP     httprequestsmuggling.thm
# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

```


### Assessing the Application
The web application for this room uses the link [http://httprequestsmuggling.thm](http://httprequestsmuggling.thm/). It features a Home, Login, and Contact form that enables users to access and send feedback to the developer. For demonstration, the submitted queries are saved to the `/submissions` directory.
	![](Pasted%20image%2020250209141456.png)

Using Burp Suite Proxy, intercept a request sent to the website's index. This request will become the baseline we will use to exploit the vulnerable application.
	![](Pasted%20image%2020250209141644.png)


**Payload:**
```shell
POST / HTTP/1.1
Host: httprequestsmuggling.thm
Content-Type: application/x-www-form-urlencoded
Content-Length: 160
Transfer-Encoding: chunked

0

POST /contact.php HTTP/1.1
Host: httprequestsmuggling.thm
Content-Type: application/x-www-form-urlencoded
Content-Length: 500

username=test&query=§
```

In CL.TE vulnerability, since the proxy or the front-end prioritises the **Content-Length** header, 160 bytes of the body is assumed to be the body of the first POST. The front-end thinks this is a single request and forwards it into the pipeline, where the back-end server now prioritises Transfer-Encoding, ending the first POST request at the first **0** size chunk and assuming the second POST is a different request.

**Payload positions box with the payload**
	![](Pasted%20image%2020250209141934.png)

Go to the **Payloads** tab and set the **Payload type** to **Null payloads**. Subsequently, on the **Payload settings**, input 10000 to generate 10000 null payloads.
	![](Pasted%20image%2020250209141957.png)

Go to the **Resource pool** tab and create a new resource pool. You may follow the screenshot below for the settings.
		![](Pasted%20image%2020250209142048.png)

Click the **Start Attack** button in your Intruder tab to start the attack.
	![](Pasted%20image%2020250209142132.png)

After a few minutes, check the `/submissions` website directory to see if the request to **contact.php** is smuggled containing the request of other users.

**Note:** Accessing the vulnerable application while the smuggling is taking effect will capture your request instead of the request from the target user.